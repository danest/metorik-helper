!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.sbjs=e()}}(function(){return function e(t,r,i){function n(a,o){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[a]={exports:{}};t[a][0].call(p.exports,function(e){var r=t[a][1][e];return n(r||e)},p,p.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){"use strict";var i=e("./init"),n={init:function(e){this.get=i(e),e&&e.callback&&"function"==typeof e.callback&&e.callback(this.get)}};t.exports=n},{"./init":6}],2:[function(e,t,r){"use strict";var i=e("./terms"),n=e("./helpers/utils"),s={containers:{current:"sbjs_current",current_extra:"sbjs_current_add",first:"sbjs_first",first_extra:"sbjs_first_add",session:"sbjs_session",udata:"sbjs_udata",promocode:"sbjs_promo"},service:{migrations:"sbjs_migrations"},delimiter:"|||",aliases:{main:{type:"typ",source:"src",medium:"mdm",campaign:"cmp",content:"cnt",id:"id",term:"trm",mtke:"mtke"},extra:{fire_date:"fd",entrance_point:"ep",referer:"rf"},session:{pages_seen:"pgs",current_page:"cpg"},udata:{visits:"vst",ip:"uip",agent:"uag"},promo:"code"},pack:{main:function(e){return s.aliases.main.type+"="+e.type+s.delimiter+s.aliases.main.source+"="+e.source+s.delimiter+s.aliases.main.medium+"="+e.medium+s.delimiter+s.aliases.main.campaign+"="+e.campaign+s.delimiter+s.aliases.main.content+"="+e.content+s.delimiter+s.aliases.main.id+"="+e.id+s.delimiter+s.aliases.main.term+"="+e.term+s.delimiter+s.aliases.main.mtke+"="+e.mtke},extra:function(e){return s.aliases.extra.fire_date+"="+n.setDate(new Date,e)+s.delimiter+s.aliases.extra.entrance_point+"="+document.location.href+s.delimiter+s.aliases.extra.referer+"="+(document.referrer||i.none)},user:function(e,t){return s.aliases.udata.visits+"="+e+s.delimiter+s.aliases.udata.ip+"="+t+s.delimiter+s.aliases.udata.agent+"="+navigator.userAgent},session:function(e){return s.aliases.session.pages_seen+"="+e+s.delimiter+s.aliases.session.current_page+"="+document.location.href},promo:function(e){return s.aliases.promo+"="+n.setLeadingZeroToInt(n.randomInt(e.min,e.max),e.max.toString().length)}}};t.exports=s},{"./helpers/utils":5,"./terms":9}],3:[function(e,t,r){"use strict";var i=e("../data").delimiter;t.exports={encodeData:function(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")},decodeData:function(e){try{return decodeURIComponent(e).replace(/\%21/g,"!").replace(/\%7E/g,"~").replace(/\%2A/g,"*").replace(/\%27/g,"'").replace(/\%28/g,"(").replace(/\%29/g,")")}catch(t){try{return unescape(e)}catch(e){return""}}},set:function(e,t,r,i,n){var s,a;if(r){var o=new Date;o.setTime(o.getTime()+60*r*1e3),s="; expires="+o.toGMTString()}else s="";a=i&&!n?";domain=."+i:"",document.cookie=this.encodeData(e)+"="+this.encodeData(t)+s+a+"; path=/"},get:function(e){for(var t=this.encodeData(e)+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var n=r[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return this.decodeData(n.substring(t.length,n.length))}return null},destroy:function(e,t,r){this.set(e,"",-1,t,r)},parse:function(e){var t=[],r={};if("string"==typeof e)t.push(e);else for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);for(var s=0;s<t.length;s++){var a;r[this.unsbjs(t[s])]={},a=this.get(t[s])?this.get(t[s]).split(i):[];for(var o=0;o<a.length;o++){var c=a[o].split("="),u=c.splice(0,1);u.push(c.join("=")),r[this.unsbjs(t[s])][u[0]]=this.decodeData(u[1])}}return r},unsbjs:function(e){return e.replace("sbjs_","")}}},{"../data":2}],4:[function(e,t,r){"use strict";t.exports={parse:function(e){for(var t=this.parseOptions,r=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},n=14;n--;)i[t.key[n]]=r[n]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,function(e,r,n){r&&(i[t.q.name][r]=n)}),i},parseOptions:{strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},getParam:function(e){for(var t={},r=(e||window.location.search.substring(1)).split("&"),i=0;i<r.length;i++){var n=r[i].split("=");if(void 0===t[n[0]])t[n[0]]=n[1];else if("string"==typeof t[n[0]]){var s=[t[n[0]],n[1]];t[n[0]]=s}else t[n[0]].push(n[1])}return t},getHost:function(e){return this.parse(e).host.replace("www.","")}}},{}],5:[function(e,t,r){"use strict";t.exports={escapeRegexp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},setDate:function(e,t){var r=e.getTimezoneOffset()/60,i=e.getHours(),n=t||0===t?t:-r;return e.setHours(i+r+n),e.getFullYear()+"-"+this.setLeadingZeroToInt(e.getMonth()+1,2)+"-"+this.setLeadingZeroToInt(e.getDate(),2)+" "+this.setLeadingZeroToInt(e.getHours(),2)+":"+this.setLeadingZeroToInt(e.getMinutes(),2)+":"+this.setLeadingZeroToInt(e.getSeconds(),2)},setLeadingZeroToInt:function(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r},randomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}},{}],6:[function(e,t,r){"use strict";var i=e("./data"),n=e("./terms"),s=e("./helpers/cookies"),a=e("./helpers/uri"),o=e("./helpers/utils"),c=e("./params"),u=e("./migrations");t.exports=function(e){var t,r,p,m,f,l,d,g,h,v,y,_=c.fetch(e),x=a.getParam(),b=_.domain.host,k=_.domain.isolate,w=_.lifetime;function q(e){switch(e){case n.traffic.utm:t=n.traffic.utm,r=void 0!==x.utm_source?x.utm_source:void 0!==x.gclid?"google":void 0!==x.yclid?"yandex":n.none,p=void 0!==x.utm_medium?x.utm_medium:void 0!==x.gclid?"cpc":void 0!==x.yclid?"cpc":n.none,m=void 0!==x.utm_campaign?x.utm_campaign:void 0!==x[_.campaign_param]?x[_.campaign_param]:void 0!==x.gclid?"google_cpc":void 0!==x.yclid?"yandex_cpc":n.none,f=x.utm_content||n.none,l=x.utm_id||n.none,d=function(){var e=document.referrer;{if(x.utm_term)return x.utm_term;if(!(e&&a.parse(e).host&&a.parse(e).host.match(/^(?:.*\.)?yandex\..{2,9}$/i)))return!1;try{return a.getParam(a.parse(document.referrer).query).text}catch(e){return!1}}}()||n.none,g=x.mtke||n.none;break;case n.traffic.organic:t=n.traffic.organic,r=r||a.getHost(document.referrer),p=n.referer.organic,m=n.none,f=n.none,l=n.none,d=n.none,g=n.none;break;case n.traffic.referral:t=n.traffic.referral,r=r||a.getHost(document.referrer),p=p||n.referer.referral,m=n.none,f=a.parse(document.referrer).path,l=n.none,d=n.none,g=n.none;break;case n.traffic.typein:t=n.traffic.typein,r=_.typein_attributes.source,p=_.typein_attributes.medium,m=n.none,f=n.none,l=n.none,d=n.none,g=n.none;break;default:t=n.oops,r=n.oops,p=n.oops,m=n.oops,f=n.oops,l=n.oops,d=n.oops,g=n.oops}var s={type:t,source:r,medium:p,campaign:m,content:f,id:l,term:d,mtke:g};return i.pack.main(s)}function I(e){var t=document.referrer;switch(e){case n.traffic.organic:return!!t&&j(t)&&function(e){var t=new RegExp("^(?:.*\\.)?"+o.escapeRegexp("yandex")+"\\..{2,9}$"),i=new RegExp(".*"+o.escapeRegexp("text")+"=.*"),n=new RegExp("^(?:www\\.)?"+o.escapeRegexp("google")+"\\..{2,9}$");{if(a.parse(e).query&&a.parse(e).host.match(t)&&a.parse(e).query.match(i))return r="yandex",!0;if(a.parse(e).host.match(n))return r="google",!0;if(!a.parse(e).query)return!1;for(var s=0;s<_.organics.length;s++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+o.escapeRegexp(_.organics[s].host)+"$","i"))&&a.parse(e).query.match(new RegExp(".*"+o.escapeRegexp(_.organics[s].param)+"=.*","i")))return r=_.organics[s].display||_.organics[s].host,!0;if(s+1===_.organics.length)return!1}}}(t);case n.traffic.referral:return!!t&&j(t)&&function(e){{if(!(_.referrals.length>0))return r=a.getHost(e),!0;for(var t=0;t<_.referrals.length;t++){if(a.parse(e).host.match(new RegExp("^(?:.*\\.)?"+o.escapeRegexp(_.referrals[t].host)+"$","i")))return r=_.referrals[t].display||_.referrals[t].host,p=_.referrals[t].medium||n.referer.referral,!0;if(t+1===_.referrals.length)return r=a.getHost(e),!0}}}(t);default:return!1}}function j(e){if(_.domain){if(k)return a.getHost(e)!==a.getHost(b);var t=new RegExp("^(?:.*\\.)?"+o.escapeRegexp(b)+"$","i");return!a.getHost(e).match(t)}return a.getHost(e)!==a.getHost(document.location.href)}function R(){s.set(i.containers.current_extra,i.pack.extra(_.timezone_offset),w,b,k),s.get(i.containers.first_extra)||s.set(i.containers.first_extra,i.pack.extra(_.timezone_offset),w,b,k)}return u.go(w,b,k),s.set(i.containers.current,function(){var e;if(void 0!==x.utm_source||void 0!==x.utm_medium||void 0!==x.utm_campaign||void 0!==x.utm_content||void 0!==x.utm_id||void 0!==x.utm_term||void 0!==x.mtke||void 0!==x.gclid||void 0!==x.yclid||void 0!==x[_.campaign_param])R(),e=q(n.traffic.utm);else if(I(n.traffic.organic))R(),e=q(n.traffic.organic);else if(!s.get(i.containers.session)&&I(n.traffic.referral))R(),e=q(n.traffic.referral);else{if(s.get(i.containers.first)||s.get(i.containers.current))return s.get(i.containers.current);R(),e=q(n.traffic.typein)}return e}(),w,b,k),s.get(i.containers.first)||s.set(i.containers.first,s.get(i.containers.current),w,b,k),s.get(i.containers.udata)?(h=parseInt(s.parse(i.containers.udata)[s.unsbjs(i.containers.udata)][i.aliases.udata.visits])||1,h=s.get(i.containers.session)?h:h+1,v=i.pack.user(h,_.user_ip)):(h=1,v=i.pack.user(h,_.user_ip)),s.set(i.containers.udata,v,w,b,k),s.get(i.containers.session)?(y=parseInt(s.parse(i.containers.session)[s.unsbjs(i.containers.session)][i.aliases.session.pages_seen])||1,y+=1):y=1,s.set(i.containers.session,i.pack.session(y),_.session_length,b,k),_.promocode&&!s.get(i.containers.promocode)&&s.set(i.containers.promocode,i.pack.promo(_.promocode),w,b,k),s.parse(i.containers)}},{"./data":2,"./helpers/cookies":3,"./helpers/uri":4,"./helpers/utils":5,"./migrations":7,"./params":8,"./terms":9}],7:[function(e,t,r){"use strict";var i=e("./data"),n=e("./helpers/cookies");t.exports={go:function(e,t,r){var s,a=this.migrations,o={l:e,d:t,i:r};if(n.get(i.containers.first)||n.get(i.service.migrations)){if(!n.get(i.service.migrations))for(s=0;s<a.length;s++)a[s].go(a[s].id,o)}else{var c=[];for(s=0;s<a.length;s++)c.push(a[s].id);var u="";for(s=0;s<c.length;s++)u+=c[s]+"=1",s<c.length-1&&(u+=i.delimiter);n.set(i.service.migrations,u,o.l,o.d,o.i)}},migrations:[{id:"1418474375998",version:"1.0.0-beta",go:function(e,t){var r=e+"=1",s=e+"=0",a=function(e,t,r){return t||r?e:i.delimiter};try{var o=[];for(var c in i.containers)i.containers.hasOwnProperty(c)&&o.push(i.containers[c]);for(var u=0;u<o.length;u++)if(n.get(o[u])){var p=n.get(o[u]).replace(/(\|)?\|(\|)?/g,a);n.destroy(o[u],t.d,t.i),n.destroy(o[u],t.d,!t.i),n.set(o[u],p,t.l,t.d,t.i)}n.get(i.containers.session)&&n.set(i.containers.session,i.pack.session(0),t.l,t.d,t.i),n.set(i.service.migrations,r,t.l,t.d,t.i)}catch(e){n.set(i.service.migrations,s,t.l,t.d,t.i)}}}]}},{"./data":2,"./helpers/cookies":3}],8:[function(e,t,r){"use strict";var i=e("./terms"),n=e("./helpers/uri");t.exports={fetch:function(e){var t=e||{},r={};if(r.lifetime=this.validate.checkFloat(t.lifetime)||6,r.lifetime=parseInt(30*r.lifetime*24*60),r.session_length=this.validate.checkInt(t.session_length)||30,r.timezone_offset=this.validate.checkInt(t.timezone_offset),r.campaign_param=t.campaign_param||!1,r.user_ip=t.user_ip||i.none,t.promocode?(r.promocode={},r.promocode.min=parseInt(t.promocode.min)||1e5,r.promocode.max=parseInt(t.promocode.max)||999999):r.promocode=!1,t.typein_attributes&&t.typein_attributes.source&&t.typein_attributes.medium?(r.typein_attributes={},r.typein_attributes.source=t.typein_attributes.source,r.typein_attributes.medium=t.typein_attributes.medium):r.typein_attributes={source:"(direct)",medium:"(none)"},t.domain&&this.validate.isString(t.domain)?r.domain={host:t.domain,isolate:!1}:t.domain&&t.domain.host?r.domain=t.domain:r.domain={host:n.getHost(document.location.hostname),isolate:!1},r.referrals=[],t.referrals&&t.referrals.length>0)for(var s=0;s<t.referrals.length;s++)t.referrals[s].host&&r.referrals.push(t.referrals[s]);if(r.organics=[],t.organics&&t.organics.length>0)for(var a=0;a<t.organics.length;a++)t.organics[a].host&&t.organics[a].param&&r.organics.push(t.organics[a]);return r.organics.push({host:"bing.com",param:"q",display:"bing"}),r.organics.push({host:"yahoo.com",param:"p",display:"yahoo"}),r.organics.push({host:"about.com",param:"q",display:"about"}),r.organics.push({host:"aol.com",param:"q",display:"aol"}),r.organics.push({host:"ask.com",param:"q",display:"ask"}),r.organics.push({host:"globososo.com",param:"q",display:"globo"}),r.organics.push({host:"go.mail.ru",param:"q",display:"go.mail.ru"}),r.organics.push({host:"rambler.ru",param:"query",display:"rambler"}),r.organics.push({host:"tut.by",param:"query",display:"tut.by"}),r.referrals.push({host:"t.co",display:"twitter.com"}),r.referrals.push({host:"plus.url.google.com",display:"plus.google.com"}),r},validate:{checkFloat:function(e){return!(!e||!this.isNumeric(parseFloat(e)))&&parseFloat(e)},checkInt:function(e){return!(!e||!this.isNumeric(parseInt(e)))&&parseInt(e)},isNumeric:function(e){return!isNaN(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)}}}},{"./helpers/uri":4,"./terms":9}],9:[function(e,t,r){"use strict";t.exports={traffic:{utm:"utm",organic:"organic",referral:"referral",typein:"typein"},referer:{referral:"referral",organic:"organic",social:"social"},none:"(none)",oops:"(Houston, we have a problem)"}},{}]},{},[1])(1)});